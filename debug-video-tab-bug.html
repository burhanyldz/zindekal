<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Tab Bug Debug</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link rel="stylesheet" href="video-player.css">
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js" defer></script>
    <script src="audio-player.js" defer></script>
    <script src="zinde-kal-modal.js" defer></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        .debug-button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 18px;
            font-weight: bold;
        }
        .debug-button:hover {
            background: #c82333;
        }
        .console-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üêõ Video Tab Switching Bug Debug</h1>
        
        <div class="console-note">
            <strong>‚ö†Ô∏è IMPORTANT:</strong> Open your browser's Developer Console (F12) to see detailed logs.
            <br>Look for logs starting with "=== HANDLEACTION START ===" when you click videos.
        </div>

        <button id="openModalBtn" class="debug-button">üé¨ Open Modal & Test Bug</button>

        <h2>Steps to Reproduce the Bug:</h2>
        <ol>
            <li>Click the button above to open the modal</li>
            <li>Go to the "Videolar" (relaxing) tab</li>
            <li>Click on ANY video in that tab</li>
            <li>üêõ <strong>BUG:</strong> It should stay in "Videolar" tab but switches to "Egzersizler" tab</li>
        </ol>

        <h2>Debug Information to Look For:</h2>
        <ul>
            <li><strong>HANDLEACTION logs:</strong> Shows which element was clicked and its parent tab</li>
            <li><strong>PLAYVIDEO logs:</strong> Shows video source and expected vs actual tab</li>
            <li><strong>SWITCHTAB logs:</strong> Shows if and why tab switching occurs</li>
        </ul>

        <h2>Expected Behavior:</h2>
        <p>Clicking a video in "Videolar" tab should play the video <strong>in the same tab</strong>, not switch to "Egzersizler".</p>
    </div>

    <script>
        // Simplified config focused on the bug
        const debugConfig = {
            container: document.body,
            modal: {
                title: "üêõ Debug Modal",
                closeOnOverlay: true,
                closeOnEscape: true,
                showCloseButton: true
            },
            tabs: {
                exercise: { title: "Egzersizler", enabled: true },
                relaxing: { title: "Videolar", enabled: true },
                music: { title: "M√ºzikler", enabled: false } // Disable music to focus on the bug
            },
            exercise: {
                categories: [
                    {
                        id: "test-exercise",
                        title: "Test Exercise Category",
                        icon: "ayak.svg",
                        iconClass: "icon-test",
                        videoCount: 1
                    }
                ],
                videos: [
                    {
                        id: "exercise-video-1",
                        categoryId: "test-exercise",
                        title: "Exercise Video (Should Stay in Exercise Tab)",
                        description: "This video should play in the exercise tab",
                        thumbnail: "thumbnails/View_From_A_Blue_Moon_Trailer-HD.jpg",
                        src: "videos/View_From_A_Blue_Moon_Trailer-1080p.mp4", // Same file, different context
                        duration: "09:01"
                    }
                ]
            },
            relaxing: {
                videos: [
                    {
                        id: "relaxing-video-1",
                        title: "ÔøΩ FIXED: Relaxing Video",
                        description: "üéØ This should now stay in relaxing tab!",
                        thumbnail: "thumbnails/View_From_A_Blue_Moon_Trailer-HD.jpg",
                        src: "videos/View_From_A_Blue_Moon_Trailer-1080p.mp4", // Same file, different context
                        duration: "09:01"
                    },
                    {
                        id: "relaxing-video-2",
                        title: "ÔøΩ Another Fixed Video",
                        description: "This should also stay in relaxing tab",
                        thumbnail: "thumbnails/View_From_A_Blue_Moon_Trailer-HD.jpg",
                        src: "videos/View_From_A_Blue_Moon_Trailer-1080p.mp4", // Same file, different context
                        duration: "09:01"
                    }
                ]
            },
            music: { currentTrack: 0, autoplay: false, tracks: [] }, // Empty music config
            toast: { enabled: false }, // Disable toast
            assets: {
                basePath: "images/",
                icons: {
                    close: "close.svg",
                    closeActive: "close-active.svg",
                    play: "play.svg",
                    pause: "pause.svg",
                    next: "next.svg",
                    prev: "prev.svg",
                    playSmall: "play-sm.svg",
                    thumbnailPlay: "thumbnail-play.svg",
                    muted: "muted.svg",
                    unmuted: "unmuted.svg"
                }
            },
            events: {
                onOpen: (modal) => {
                    console.log('üé¨ DEBUG: Modal opened');
                },
                onClose: (modal) => {
                    console.log('üé¨ DEBUG: Modal closed');
                },
                onTabChange: (newTab, oldTab, modal) => {
                    console.log('üé¨ DEBUG: Tab changed from', oldTab, 'to', newTab);
                    if (oldTab === 'relaxing' && newTab === 'exercise') {
                        console.error('üêõ BUG DETECTED: Switched from relaxing to exercise!');
                    }
                },
                onVideoPlay: (videoSrc, modal) => {
                    console.log('üé¨ DEBUG: Video play requested:', videoSrc);
                }
            }
        };

        let zindeKalModal;

        document.addEventListener('DOMContentLoaded', function() {
            try {
                zindeKalModal = new ZindeKalModal(debugConfig);
                
                document.getElementById('openModalBtn').addEventListener('click', () => {
                    console.clear(); // Clear console for better debugging
                    console.log('üé¨ DEBUG SESSION STARTED - Opening modal...');
                    zindeKalModal.open();
                    
                    // Automatically switch to relaxing tab for easier testing
                    setTimeout(() => {
                        console.log('üé¨ AUTO-SWITCHING to relaxing tab for testing...');
                        zindeKalModal.switchTab('relaxing');
                    }, 500);
                });
                
            } catch (error) {
                console.error('üêõ Failed to initialize modal:', error);
            }
        });
    </script>
</body>
</html>