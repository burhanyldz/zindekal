<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player Fix Test</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link rel="stylesheet" href="video-player.css">
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js" defer></script>
    <script src="audio-player.js" defer></script>
    <script src="zinde-kal-modal.js" defer></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 6px;
            font-family: monospace;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ZindeKal Video Player Fix Test</h1>
        <p>This test verifies the two fixes:</p>
        <ol>
            <li><strong>Visibility Issue:</strong> Videos should be visible in both Exercise and Relaxing tabs</li>
            <li><strong>Multiple Videos:</strong> Starting a new video should pause any currently playing video</li>
        </ol>

        <div class="test-section">
            <h3>Test Actions</h3>
            <button id="openModalBtn" class="test-button">Open ZindeKal Modal</button>
            <button id="testExerciseTab" class="test-button">Test Exercise Tab Videos</button>
            <button id="testRelaxingTab" class="test-button">Test Relaxing Tab Videos</button>
        </div>

        <div class="test-section">
            <h3>Test Status</h3>
            <div id="status" class="status">
                Ready to test...
            </div>
        </div>

        <div class="test-section">
            <h3>Test Instructions</h3>
            <ol>
                <li>Click "Open ZindeKal Modal" to open the modal</li>
                <li>Go to the "Egzersizler" tab and click on a video - verify it shows and plays immediately</li>
                <li><strong>MAIN TEST:</strong> Go to the "Videolar" tab and click on a video - it should now show and play on the FIRST click</li>
                <li>Start playing multiple videos to verify only one plays at a time</li>
                <li>Switch between tabs while videos are playing</li>
            </ol>
            
            <h4>Expected Behavior (Fixed):</h4>
            <ul>
                <li>✅ Videos in both tabs should be visible immediately on first click</li>
                <li>✅ No need for multiple clicks to see the video player</li>
                <li>✅ Only one video plays at a time across all tabs</li>
                <li>✅ Proper tab switching when clicking videos from inactive tabs</li>
            </ul>
        </div>
    </div>

    <script>
        // Enhanced test configuration with relaxing videos
        const testConfig = {
            container: document.body,
            modal: {
                title: "Zinde Kal - Video Test",
                closeOnOverlay: true,
                closeOnEscape: true,
                showCloseButton: true
            },
            tabs: {
                exercise: { title: "Egzersizler", enabled: true },
                music: { title: "Müzikler", enabled: true },
                relaxing: { title: "Videolar", enabled: true }
            },
            exercise: {
                categories: [
                    {
                        id: "ankle",
                        title: "Ayak Bileği Egzersizi",
                        icon: "ayak.svg",
                        iconClass: "icon-ayak",
                        videoCount: 2
                    }
                ],
                videos: [
                    {
                        id: "ankle-1",
                        categoryId: "ankle",
                        title: "Exercise Video 1",
                        description: "Test video for exercise tab",
                        thumbnail: "thumbnails/View_From_A_Blue_Moon_Trailer-HD.jpg",
                        src: "videos/View_From_A_Blue_Moon_Trailer-1080p.mp4",
                        duration: "09:01"
                    },
                    {
                        id: "ankle-2",
                        categoryId: "ankle",
                        title: "Exercise Video 2",
                        description: "Another test video for exercise tab",
                        thumbnail: "thumbnails/View_From_A_Blue_Moon_Trailer-HD.jpg",
                        src: "videos/View_From_A_Blue_Moon_Trailer-1080p.mp4",
                        duration: "09:01"
                    }
                ]
            },
            relaxing: {
                videos: [
                    {
                        id: "peaceful-1",
                        title: "Relaxing Video 1",
                        description: "Test video for relaxing tab - this should be visible now",
                        thumbnail: "thumbnails/View_From_A_Blue_Moon_Trailer-HD.jpg",
                        src: "videos/View_From_A_Blue_Moon_Trailer-1080p.mp4",
                        duration: "09:01"
                    },
                    {
                        id: "peaceful-2",
                        title: "Relaxing Video 2",
                        description: "Another test video for relaxing tab",
                        thumbnail: "thumbnails/View_From_A_Blue_Moon_Trailer-HD.jpg",
                        src: "videos/View_From_A_Blue_Moon_Trailer-1080p.mp4",
                        duration: "09:01"
                    }
                ]
            },
            music: {
                currentTrack: 0,
                autoplay: false,
                tracks: [
                    {
                        id: "track-1",
                        title: "Test Track",
                        artist: "Test Artist",
                        src: "music/Vivaldi - The Four Seasons.mp3",
                        duration: "4:12"
                    }
                ]
            },
            toast: {
                enabled: true,
                message: "Testing video player fixes...",
                icon: "images/kanka.png",
                autoHideDelay: 5000
            },
            assets: {
                basePath: "images/",
                icons: {
                    close: "close.svg",
                    closeActive: "close-active.svg",
                    play: "play.svg",
                    pause: "pause.svg",
                    next: "next.svg",
                    prev: "prev.svg",
                    playSmall: "play-sm.svg",
                    thumbnailPlay: "thumbnail-play.svg",
                    muted: "muted.svg",
                    unmuted: "unmuted.svg"
                }
            },
            events: {
                onOpen: (modal) => {
                    updateStatus('Modal opened successfully');
                },
                onClose: (modal) => {
                    updateStatus('Modal closed');
                },
                onTabChange: (newTab, oldTab, modal) => {
                    updateStatus(`Tab changed: ${oldTab} → ${newTab}`);
                },
                onVideoPlay: (videoSrc, modal) => {
                    updateStatus(`Video play requested: ${videoSrc.split('/').pop()}`);
                },
                onAudioPlay: (track, modal) => {
                    updateStatus(`Audio playing: ${track?.title || 'Unknown'}`);
                },
                onAudioPause: (track, modal) => {
                    updateStatus(`Audio paused: ${track?.title || 'Unknown'}`);
                }
            }
        };

        function updateStatus(message) {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.innerHTML += `<div><strong>${timestamp}:</strong> ${message}</div>`;
            status.scrollTop = status.scrollHeight;
        }

        let zindeKalModal;

        document.addEventListener('DOMContentLoaded', function() {
            try {
                zindeKalModal = new ZindeKalModal(testConfig);
                updateStatus('ZindeKal Modal initialized successfully');
                
                document.getElementById('openModalBtn').addEventListener('click', () => {
                    zindeKalModal.open();
                });
                
                document.getElementById('testExerciseTab').addEventListener('click', () => {
                    zindeKalModal.open();
                    zindeKalModal.switchTab('exercise');
                    updateStatus('Switched to exercise tab - test video visibility and playback');
                });
                
                document.getElementById('testRelaxingTab').addEventListener('click', () => {
                    zindeKalModal.open();
                    zindeKalModal.switchTab('relaxing');
                    updateStatus('Switched to relaxing tab - test video visibility and playback (main fix)');
                });
                
            } catch (error) {
                updateStatus(`Error: ${error.message}`);
                console.error('Failed to initialize ZindeKal Modal:', error);
            }
        });

        updateStatus('Test page loaded. Ready to test video player fixes.');
    </script>
</body>
</html>